<div id="project-detail" class="container">

  <div class="row">
    <div class="col-xs-12 col-md-8">
      <div class="row">
        <div class="col-xs-12">
          <div class="panel panel-default">
            <div class="panel-body">
              <div class="row">
                <div class="hidden-xs hidden-md col-lg-5">
                  <img ng-src="{{baseFileUrl + project.image}}" alt="" width="230" height="225" class="img-rounded">
                </div>
                <div class="col-lg-7">
                  <div class="row">
                    <div class="col-xs-12 under-margin">
                      <h1 class="project-name">{{ project.name || '项目名称'}}</h1>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xs-12 col-sm-4 border-r under-margin">
                      <h3 class="text-center text-nowrap hc-text-red">{{project.annualEarnings || 0 | number : 2}}%</h3>
                      <p class="text-center text-nowrap gray-font">年化收益</p>
                    </div>
                    <div class="col-xs-12 col-sm-4 border-r under-margin">
                      <h3 class="text-center text-nowrap">{{project.total/10000 || 0}}万</h3>
                      <p class="text-center text-nowrap gray-font">项目规模</p>
                    </div>
                    <div class="col-xs-12 col-sm-4 under-margin">
                      <h3 class="text-center text-nowrap">{{project.cycle || 0}}个月</h3>
                      <p class="text-center text-nowrap gray-font">项目期限</p>
                    </div>
                  </div>
                  <!--  <div class="row">
                      <div class="col-xs-12 under-margin">
                        发布日期：{{ project.publishTime || 0 | amDateFormat: 'YYYY年MM月DD日'}}
                      </div>
                    </div> -->
                  <hr style="margin-top: 3px;margin-bottom: 12px;">
                  <div class="row">
                    <div class="col-xs-12 under-margin1" ng-hide="categoryCode === '04'"><i class="fa fa-circle hc-text-red right-margin"></i>
                      <strong>担保机构：<a ui-sref="root.project-sponsorInstitution({guaranteeId: project.guaranteeId})" target="_blank">{{project.guaranteeName}}</a></strong>
                    </div>
                    <div class="col-xs-12 under-margin1"><i class="fa fa-circle hc-text-red right-margin"></i>
                      <strong>还款方式：{{project.repaymentName}}</strong>
                    </div>
                    <div class="col-xs-12" ng-class="{'under-margin1': project.status === 9 || project.status === 10}"><i class="fa fa-circle hc-text-red right-margin"></i>
                      <strong>发布日期：{{ project.publishTime || 0 | amDateFormat: 'YYYY年MM月DD日'}}</strong>
                    </div>
                    <div ng-if="project.progress >= 100 && project.status === 9 || project.status === 10">
                      <div class="col-xs-12"><i class="fa fa-circle hc-text-red right-margin"></i>
                        <strong>还款日期：{{ project.repaymentDate || 0 | amDateFormat: 'YYYY年MM月DD日'}}</strong>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="hidden-xs col-sm-12">&nbsp;</div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <div class="panel panel-default project-info" ng-init="activeTab=0;">
            <ul class="nav nav-pills nav-justified">
              <li ng-class="{active: activeTab===$index}" ng-repeat="tab in tabs"><a ng-click="switchTab($index)">{{tab.title}}</a>
              </li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane" ng-class="{active: activeTab===$index}" ng-repeat="tab in tabs">
                <section ng-if="tab.title==='项目信息'">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 项目简介</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{projectInfo.description}}</p>
                      </div>
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 资金用途</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{projectInfo.financingPurpose}}</p>
                      </div>
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 还款来源</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{projectInfo.repaymentSource}}</p>
                      </div>
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 项目评级
                            <span ng-if="projectRank.symbol !== ''" ng-class="{'a3' : projectRank.symbol==='AAA','a2' : projectRank.symbol==='AA','a1' : projectRank.symbol==='A','b3' : projectRank.symbol==='BBB','b2' : projectRank.symbol==='BB','b1' : projectRank.symbol==='B','c' : projectRank.symbol==='C'}" class="project-rate">&nbsp;</span>
                          </h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{projectRank.description}}</p>
                      </div>
                    </div>
                  </div>
                </section>
                <section ng-if="tab.title==='企业信息'">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 企业背景</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{enterprise.background}}</p>
                      </div>
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 营业范围</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{enterprise.businessScope}}</p>
                      </div>
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 经营状况</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{enterprise.businessState}}</p>
                      </div>
                    </div>
                  </div>
                </section>
                <section ng-if="tab.title==='风控信息'">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i>担保机构</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{projectInfo.guaranteeSuggestion}}</p>
                      </div>
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i>风控措施</h4>
                      </div>
                      <div class="col-xs-12">
                        <p>{{projectInfo.riskManagementInfo}}</p>
                      </div>
                    </div>
                  </div>
                </section>
                <section ng-if="tab.title==='相关文件'">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 合同协议</h4>
                      </div>
                      <div class="col-xs-6 col-sm-4 file-padding" ng-repeat="contract in contractThumbnailFileList">
                        <!-- <div class="thumbnail">
                            <a class="grouped_elements" rel="group1" href="{{contractOriginalFileList[$index].uploadFile.url}}"><img fancybox width="175" height="125" hc-preview-url="{{enterPrise.uploadFile.url}}" ng-src="{{contract.uploadFile.url}}"></a>
                            <div class="caption">
                              <h5 class="file-head">{{contract.uploadFile.originalName}}</h5>
                            </div>
                          </div> -->

                        <div class="thumbnail">
                          <a class="grouped_elements" rel="group1" href="javascript:;" ng-click="openFancybox()">
                            <img width="175" height="125" ng-src="{{baseFileUrl + contract.uploadFile.url}}">
                          </a>
                          <div class="caption">
                            <h5 class="file-head">{{contract.uploadFile.originalName.split('.')[0]}}</h5>
                          </div>
                          <div class="wrapper" fancybox style="display: none;">
                            <div class="future_fancybox_content">
                              <img src="{{baseFileUrl + contractOriginalFileList[$index].uploadFile.url}}" />
                            </div>
                          </div>
                        </div>

                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 企业相关照片</h4>
                      </div>
                      <div class="row">
                        <div class="col-xs-6 col-sm-4 col-md-4 col-lg-4 file-padding" ng-repeat="enterPrise in enterpriseThumbnailFileList">
                          <div class="thumbnail">
                            <a class="grouped_elements" rel="group1" href="javascript:;" ng-click="openFancybox()">
                              <img width="175" height="125" ng-src="{{baseFileUrl + enterPrise.uploadFile.url}}">
                            </a>
                            <div class="caption">
                              <h5 class="file-head">{{enterPrise.uploadFile.originalName.split('.')[0]}}</h5>
                            </div>
                            <div class="wrapper" fancybox style="display: none;">
                              <div class="future_fancybox_content">
                                <img src="{{baseFileUrl + enterpriseOriginalFileList[$index].uploadFile.url}}" />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>
                </section>
                <section ng-if="tab.title==='项目历程'">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xs-12">
                        <h4 class="page-header"><i class="fa fa-square hc-text-red"></i> 项目历程</h4>
                        <ul class="timeline">
                          <li>
                            <div class="timeline-badge primary"><i class="fa fa-rocket"></i>
                            </div>
                            <div class="timeline-panel">
                              <div class="timeline-heading">
                                <h4 class="timeline-title">项目上线</h4>
                              </div>
                              <div class="timeline-body">
                                <p>上线时间：{{project.publishTime}}</p>
                              </div>
                            </div>
                          </li>
                          <li class="timeline-inverted">
                            <div class="timeline-badge info"><i class="fa fa-users"></i>
                            </div>
                            <div class="timeline-panel">
                              <div class="timeline-heading">
                                <h4 class="timeline-title">项目募集</h4>
                              </div>
                              <div class="timeline-body">
                                <p>开始时间：{{project.releaseStartTime}}</p>
                                <p>结束时间：{{project.releaseEndTime}}</p>
                              </div>
                            </div>
                          </li>
                          <li>
                            <div class="timeline-badge warning"><i class="fa fa-tree"></i>
                            </div>
                            <div class="timeline-panel">
                              <div class="timeline-heading">
                                <h4 class="timeline-title">项目放款</h4>
                              </div>
                              <div class="timeline-body">
                                <p>已还：{{projectInfo.projectBackTotal - (remainPrincipal + remainInterest) | number:2 }}（{{billCount}}期）</p>
                              </div>
                            </div>
                          </li>
                          <li class="timeline-inverted">
                            <div class="timeline-badge success"><i class="fa fa-list-ol"></i>
                            </div>
                            <div class="timeline-panel">
                              <div class="timeline-heading">
                                <h4 class="timeline-title">项目还款</h4>
                              </div>
                              <div class="timeline-body">
                                <p>待还款：{{remainPrincipal + remainInterest | number:2 }}（{{project.cycle - billCount}}期）</p>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-md-4">
      <div class="row">
        <div class="col-xs-12">
          <div class="form-horizontal">
            <div class="panel panel-default status">
              <div class="panel-heading ft-16 padding-tAb">
                <strong>投资状态</strong><img src="images/zengliang_03.png" class="project-bianju">
              </div>
              <div class="panel-body">
                <div class="row">
                  <div class="col-xs-12 negative-margin" ng-show="project.status !== 6">
                    <span class="pull-left investment-fontsize">投资进度：</span>
                    <div class="progress">
                      <div class="progress-bar progress-bar-info hc-bg-red" role="progressbar" aria-valuenow="{{project.progress || 0}}" aria-valuemin="0" aria-valuemax="100" style="width: {{project.progress||0 }}%">{{project.progress || 0 | number : 2}}%</div>
                    </div>
                  </div>
                  <div class="col-xs-12 negative-margin">
                    <span class="investment-fontsize">可投金额：</span><span class="investment-fontred">{{projectInvestNum | number : 2}}</span><span class="investment-fontblack">元</span>
                  </div>
                </div>
                <!-- 未登录状态 -->
                <div class="col-xs-12 padding-0 positive-margin" ng-if="!isLogged">
                  <span class="investment-fontsize">可用余额：</span><span class="investment-fontgray">(登录后查看)</span>
                </div>
                <div class="col-xs-12 padding-0" ng-show="!isLogged && project.status === 6 ">
                  <div class="row padding-t-0">
                    <div class="col-xs-12 project-timer countdown-background" style="margin-top:10px;">
                      <p class="countdown-fontsize">{{ statDay }}{{ statTime }}</p>
                    </div>
                  </div>
                  <div class="positive-margin1"><a ui-sref="root.login({isRedirect: true})" class="btn btn-danger btn-lg btn-block"><i class="fa fa-user project-leftmargin"></i>请先登录</a>
                  </div>
                  <div class="positive-margin1 positive-leftmargin project-center"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">请先登录，再进行投资</span>
                  </div>
                </div>

                <div class="col-xs-12 padding-0" ng-show="!isLogged && project.status !== 6">
                  <div class="positive-margin1">
                    <input type="number" placeholder="请输入投资金额" disabled='disabled' class="form-control margin-b-20">
                  </div>
                  <div class="positive-margin1"><a ui-sref="root.login({isRedirect: true})" class="btn btn-danger btn-lg btn-block"><i class="fa fa-user project-leftmargin"></i>请先登录</a>
                  </div>
                  <div class="positive-margin1 positive-leftmargin project-center"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">请先登录，再进行投资</span>
                  </div>
                </div>

                <!-- 登录已满标状态 -->
                <div class="col-xs-12 padding-0" ng-if="isLogged && project.progress >= 100">
                  <div class="positive-bottommargin"><span class="investment-fontsize">可用余额：</span><span class="investment-fontred">{{userCapital.balance | number: 2}}</span><span class="investment-fontblack">元</span>
                  </div>
                  <div ng-if="project.status === 8">
                    <button class="btn btn-danger btn-lg btn-block positive-bottommargin" disabled="disabled"><i class="fa fa-check-circle fa-lg project-leftmargin"></i>融资成功</button>
                    <div class="positive-margin1 project-center"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">项目已融资成功，等待放款</span>
                    </div>
                  </div>
                  <div ng-if="project.status === 10">
                    <button class="btn btn-danger btn-lg btn-block positive-bottommargin" disabled="disabled"><i class="fa fa-jpy fa-lg project-leftmargin"></i>还款完成</button>
                    <div class="positive-margin1 project-center" ><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">企业已完成项目还款</span>
                    </div>
                  </div>
                  <div ng-if="project.status === 9">
                    <button class="btn btn-danger btn-lg btn-block positive-bottommargin" disabled="disabled"><i class="fa fa-jpy fa-lg project-leftmargin"></i>还款中</button>
                    <div class="positive-margin1 project-center"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">企业按照计划，正常还款中</span>
                    </div>
                  </div>
                  <div ng-if="project.currentStock === 0 && project.status === 7">
                    <button class="btn btn-danger btn-lg btn-block positive-bottommargin" disabled="disabled"><i class="fa fa-shopping-cart fa-lg project-leftmargin"></i>融资中</button>
                    <div class="positive-margin1 project-center"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">仍有用户尚未完成支付,您还有投资机会~~~</span>
                    </div>
                  </div>
                </div>
                <!-- 登录，完善资料 -->
                <div class="row padding-t-0" ng-if="isLogged && project.progress < 100 && project.status != 6">

                  <div class="col-xs-12" ng-if="securityStatus.realNameAuthStatus + securityStatus.mobileStatus + securityStatus.emailStatus < 3">
                    <div class="positive-bottommargin"><span class="investment-fontsize">可用余额：</span><span class="investment-fontred">{{userCapital.balance| number:2}}</span><span class="investment-fontblack">元</span>
                    </div>
                    <div class="positive-margin1">
                      <input type="number" placeholder="请输入投资金额" disabled='disabled' class="form-control margin-b-20">
                    </div>
                    <button class="btn btn-danger btn-lg btn-block positive-bottommargin" ng-click="Alertdata()"><i class="fa fa-shopping-cart fa-lg project-leftmargin"></i>立即投资</button>
                    <div class="positive-margin1 project-center"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">请先完成资料，再进行投资</span>
                    </div>
                  </div>
                  <!-- 资料完善已登录 -->
                  <div class="col-xs-12" ng-if="securityStatus.realNameAuthStatus + securityStatus.mobileStatus + securityStatus.emailStatus == 3">
                    <div ng-switch on="isAvailable">
                      <div class="col-xs-12 positive-bottommargin pull-n">
                        <span class="investment-fontsize nagtive-leftmargin">可用余额：</span><span class="investment-fontred">{{userCapital.balance | number:2}}</span><span class="investment-fontblack">元</span>
                      </div>
                      <div class="col-xs-12" ng-switch-when="1">
                        <!-- 有未完成的订单时展示 -->
                        <button class="btn btn-lg btn-danger btn-block positive-margin1" data-animation="am-fade-and-slide-top" data-template="views/modal/alert-unfinishedOrder.html" data-placement="top" data-container="body" data-duration="1000" bs-alert="alert">立即投资</button>
                      </div>
                      <form ng-submit="isAvailableInvest(project);" ng-switch-default>
                        <input type="number" min="{{project.minInvest}}" max="{{userCanInvestNum}}" step="{{project.increaseAmount}}" name="project.amount" ng-model="project.amount" class="form-control margin-b-20" placeholder="投资金额（元）" required ng-switch-default>
                        <input type="hidden" name="project.id" ng-model="project.id" value="{{project.id}}">
                        <button class="btn btn-danger btn-lg btn-block" ng-switch-default><i class="fa fa-shopping-cart project-leftmargin"></i>立即投资</button>
                      </form>
                      <div class="positive-margin1 project-center" ><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">优质项目，抓紧时间投资吧~~</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row padding-t-0" ng-if="isLogged && statSecond > 1 && project.status === 6 ">
                  <!-- <div class="col-xs-12">开放投资倒计时：</div> -->
                  <div class="col-xs-12 positive-bottommargin"><span class="investment-fontsize">可用余额：</span><span class="investment-fontred">{{userCapital.balance | number:2}}</span><span class="investment-fontblack">元</span>
                  </div>
                  <div class="col-xs-12 project-timer countdown-background">
                    <p class="countdown-fontsize">{{ statDay }}{{ statTime }}</p>
                    <!-- <timer interval="1000" countdown="statSecond" finish-callback="finished()"><span> {{days}} 天,</span> <span>{{hours}} 小时,</span><span>{{minutes}} 分,</span> <span>{{seconds}} 秒</span></timer> -->
                  </div>
                </div>
                <div ng-if="isLogged && project.status === 6">
                  <button class="btn btn-danger btn-lg btn-block " disabled="disabled"><i class="fa fa-clock-o fa-lg project-leftmargin"></i>预发布</button>
                  <div class="positive-margin1" style="margin-left:22%"><i class="fa fa-info-circle fa-lg fa-gray i-rightmargin"></i><span class="spangray">优质项目，敬请期待</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <div class="panel panel-default" ng-init="activeTabRight=0;">
            <ul class="nav nav-pills nav-justified border-b">
              <li ng-class="{active: activeTabRight===$index}" ng-repeat="tab_right in tabsRight"><a ng-click="switchTabRight($index)">{{tab_right.title}}</a>
              </li>

            </ul>
            <div class="tab-content">
              <div class="tab-pane" ng-class="{active: activeTabRight===$index}" ng-repeat="tab_right in tabsRight">
                <section ng-if="tab_right.title==='投资记录'">
                  <div class="panel-body">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>成交时间</th>
                          <th>投资人</th>
                          <th>投标金额</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr ng-repeat="order in orderList | startFrom:currentPage * pageSize | limitTo:pageSize">
                          <td>{{order.createTime | date: "yy-MM-dd"}}</td>
                          <td>{{order.userName}}</td>
                          <td>{{order.orderAmount| number : 0}}元</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <ul class="list-group">
                    <li class="list-group-item">
                      <div class="row">
                        <div class="col-sx-12 text-center">
                          <button class="btn btn-sm" ng-disabled="currentPage == 0" ng-click="currentPage = currentPage - 1" disabled="disabled">上一页</button>
                          {{currentPage + 1 }} / {{numberOfPages()}} 共 {{data.length}} 条
                          <button class="btn btn-sm" ng-disabled="currentPage >= data.length / pageSize - 1" ng-click="currentPage = currentPage + 1" disabled="disabled">下一页</button>
                        </div>
                      </div>
                    </li>
                  </ul>
                </section>
                <section ng-if="tab_right.title==='还款计划'">
                  <div class="panel-body">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>预期还款时间</th>
                          <th>类型</th>
                          <th>还款金额</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr ng-repeat="preRepayment in preRepaymentList">
                          <td>{{preRepayment.repaymentTime | date: "yy-MM-dd"}}</td>
                          <td ng-show="preRepayment.type==1">利息</td>
                          <td ng-show="preRepayment.type==2">本金</td>
                          <td ng-show="preRepayment.type==3">本金+利息</td>
                          <td>{{preRepayment.repaymentAmount| number:2}}元</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </section>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
